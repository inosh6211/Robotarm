#include <Arduino.h>
#include <SCServo.h>

// USART1: TX = PA9, RX = PA10
HardwareSerial mySerial(PA9, PA10);  // 半二重シリアル通信用
SMS_STS st;  // STSサーボ用インスタンス

void setup() {
  // デバッグ用シリアル（PC表示用）
  Serial.begin(115200);
  delay(200);

  // サーボ用シリアルの初期化（半二重）
  Serial.println("kaishi");
  mySerial.setHalfDuplex();
  Serial.println("Set half duplex");
  mySerial.begin(1000000);
  Serial.println("Serial started");


  // 簡易表示
  Serial.println("サーボ制御開始");

  // ID:1 にPingして応答があるか確認
  int id = st.Ping(1);
  if (id == -1) {
    Serial.println("エラー: サーボが応答しません (ID:1)");
  } else {
    Serial.print("サーボ応答あり (ID:"); Serial.print(id); Serial.println(")");
  }

  // トルクON（Enable）
  st.EnableTorque(1, 1);

  delay(500);

  // サーボを位置600に2秒かけて移動（速度・加速度指定）
  st.WritePosEx(1, 600, 1000, 50);  // ID, 目標位置, 速度, 加速度

  delay(3000);  // 待機

  // 位置300へ1秒で移動
  st.WritePosEx(1, 300, 1000, 50);

  delay(3000);  // 終了待機
}

void loop() {
  // 一度だけ動かせばよいので空
}
